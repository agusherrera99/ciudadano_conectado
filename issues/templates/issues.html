{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Reclamos</title>
        <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
        <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css"> 
        <link rel="stylesheet" href="{% static 'css/issues.css' %}">
    </head>

    <body>
        {% include 'components/navbar.html' %}

        <main>
            <!-- Requests Section -->
            <section id="request-section">
                <h1>Gestión de Solicitudes</h1>

                <div class="section-content">
                    <button id="new-request-btn" class="btn btn-primary" aria-label="Nueva Solicitud">Nueva Solicitud</button>
                
                    <div id="new-request-form" class="hidden">
                        <h3>Crear Nueva Solicitud</h3>
                        <form method="POST" id="request-form">
                            {% csrf_token %}
                            <div class="form-group">
                                <label for="category">Tipo de Solicitud</label>
                                <select id="category" name="category" required>
                                    <option value="">Seleccione un tipo</option>
                                    <option value="reclamo">Reclamo</option>
                                    <option value="sugerencia">Sugerencia</option>
                                    <option value="consulta">Consulta</option>
                                    <option value="otro">Otro</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="description">Descripción</label>
                                <textarea id="description" name="description" required></textarea>
                            </div>
                                
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary" aria-label="Enviar Solicitud">Enviar Solicitud</button>
                                <button type="button" class="btn btn-secondary" id="cancel-request-btn" aria-label="Cancelar Solicitud">Cancelar</button>
                            </div>
                        </form>
                    </div>
                    
                    <div id="request-list">
                        <h3>Mis Solicitudes</h3>
                        <div class="filters">
                            <select id="filter-type">
                                <option value="">Todos los tipos</option>
                                <option value="reclamo">Reclamo</option>
                                <option value="sugerencia">Sugerencia</option>
                                <option value="consulta">Consulta</option>
                                <option value="otro">Otro</option>
                            </select>
                            <select id="filter-status">
                                <option value="">Todos los estados</option>
                                <option value="pendiente">Pendiente</option>
                                <option value="recibido">Recibido</option>
                                <option value="en proceso">En proceso</option>
                                <option value="resuelto">Resuelto</option>
                            </select>
                            <input type="date" id="filter-date">
                            <button class="btn btn-secondary" id="clearFilterBtn">
                                <i class="fas fa-eraser" title="Limpiar Filtros"></i>
                            </button>
                        </div>
                        <ul class="request-items">
                            {% if issues %}
                                {% for issue in issues %}
                                <li class="request-item">
                                    <div class="request-header">
                                        <span class="request-type">{{ issue.category|capfirst }}</span>
                                        
                                        {% if issue.category == 'en proceso' %}
                                            <span class="request-status en-proceso">En Proceso</span>
                                        {% else %}
                                            <span class="request-status {{ issue.status }}">{{ issue.status|capfirst }}</span>
                                        {% endif %}
                                        
                                    </div>
                                    <p class="request-description">{{ issue.description|capfirst }}</p>
                                    <div class="request-actions">
                                        <a class="btn btn-tertiary request-details" href="{% url 'issues:issue_detail' issue.id %}">Ver Detalles</a>
                                        <span class="request-date">Creada el: {{ issue.created_at|date:"d-m-Y" }}</span>
                                    </div>
                                </li>
                                {% endfor %}
                            {% else %}
                                <li class="request-item">
                                    <p>No hay solicitudes registradas</p>
                                </li>
                            {% endif %}
                        </ul>
                    </div>
                </div>    
            </section>
        </main>

        <script src="{% static 'js/issues.js' %}"></script>
    </body>
</html>